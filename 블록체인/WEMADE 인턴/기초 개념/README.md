# Klaytn 클레이튼 스마트계약과 탈중앙앱  

교육 자료: [Klaytn 클레이튼 스마트계약과 탈중앙앱](https://www.inflearn.com/course/klaytn-%EC%8A%A4%EB%A7%88%ED%8A%B8%EA%B3%84%EC%95%BD%EA%B3%BC-%ED%83%88%EC%A4%91%EC%95%99%EC%95%B1#curriculum)  


## 0. 블록체인 기본  

- **블록체인**이란? 정보를 **블록**이라고 하는 단위로 젖아하여 저장된 블록들을 **체인**형태로 묶은 저장 기술  
데이터들은 일정한 순서로 정렬되어 묶음으로 저장되는데 이를 '블록'이라고 함. 첫번째 블록(Genesis Block)에서 시작되어 블록들은 서로 체인으로 연결되고 이 순서는 유지가 됨.  
Linked List와 비슷한 형태지만 앞의 블록을 기억하는 방법이 다름(해시 함수 사용). 

- **블록, 블록헤더, 해시포인터**?  
자료구조: 누가 누굴 기억하느냐가 중요(뒤가 앞을 기억? 앞을 뒤가 기억?), 메모리 주소에 데이터를 매핑하므로 메모리 주소를 기억  
블록은 헤더와 바디로 구분. 헤더는 블록을 설명하는 정보와 이전 블록의 해시 포함. 이전 블록의 해시(hash pointer)를 가지기 때문에  
(1) 어떤 블록이 앞에 와야하는지 결정적으로 알 수 있고 (2) 이를 바탕으로 블록의 순서를 결정할 수 있음  
바디는 정보의 묶음. 이 데이터를 설명해주는 헤더(이 묶여진 일련의 데이터들을 어떻게 검증해야하는지, 검증에 무엇이 필요한지 등의 정보)  

- **블록높이, 블록생성주기**?  
블록체인을 처음에 구상한 사람들은 수직으로 0번이 바닥에 깔리고 그 위로 쌓이고, 0번을 빼버리면 모든게 흔들려 버린다고 생각. 그래서 차곡차곡 쌓아 올린다고 생각. -> 높이 개념 등장  
블록들을 이전 블록이 아래에 최근 블록이 위로 오도록 정렬하면 블록이 생성됨에 따라 체인의 높이가 늘어난다. 블록의 순서를 그 블록이 위치한 '높이'(block height)라 부른다. 첫번째 블록은 편의상 높이를 0이라 한다.  
다음 블록을 생성하기까지 걸리는 시간을 '블록생성시간'이라 하고, 블록생성시간이 비교적 일정한 경우 '블록생성주기'란 표현을 사용. (대부분은 주기마다 만듦, 비트코인은 10분, 이더리움 15초 정도에 수렴, 클레이튼 1초)  
블록생성주기는 아주 중요하다. 데이터가 블록에 들어가게 되는걸 '체결'. 체결시간이 짧을 수록 서비스에 적합하기 때문. (클레이튼은 서비스 지향적인 블록체인)  

- **블록체인 네트워크, 노드**?  
보통 우리가 아는 Request-Response(Client-Server) 구조. 연산력이 부족하거나 컨텐츠가 부족한 클라이언트가 반대로 연산 능력이 충분하거나 콘텐츠가 충분한 서버에게 요청하고 응답을 받음.  
그러나, 블록체인은 기본적으로 P2P 네트워크(Peer-to-Peer Network) ex) 토렌트, 소리바다(누구 한명에게 의존하는 구조 X. 나와 같은 데이터를 가진 다른 사람이 그 데이터를 줄 수 있음. 빠진 데이터 채우기 -> 탈중앙화)  
블록체인은 한명 이상의 참여자(노드)가 있는 네트워크에서 관리.  
네트워크 참여자 전원은 모든 블록을 동일한 순서로 저장하여 모두 같은 블록체인을 유지.  

- **합의(Consensus)**?  
중앙이 원장을 가지고 있고, 우리는 모두 중앙을 믿고 의존함. ex) Alice의 잔고가 실제로 100불인거 맞아? 중앙은행한테 물어보고 은행이 검증해줌. 은행이 모든 사람들의 돈이 적힌 원장을 가지고 있으니까.  
블록체인은 모두가 원장을 가지고 있고, 모두가 기억을 할 수 있으므로 모두가 검증을 할 수 있음. 그러므로 모두의 합의가 필요한 상황이 있음 ex) Alice가 50불을 Bob에게 보낼 수 있는지 없는지 맞아?  
자격이 있는 참여자는 블록을 제안(propse)할 수 있음: 제안자(Proposer)  
블록 제안 자격은 네트워크마다 상이 (e.g., PoW: 제안자의 익명성은 지켜지지만 제안자의 work을 통해 올바른 참여자라고 생각하여 그 블록을 받아들여줌)  
노드들은 제안자가 올바른 자격을 취즉했는지, 제안된 블록이 올바른지 **검증** 뒤 블록을 자신의 체인에 추가. ex) 나는 Alice가 50불을 보낼 수 있는게 맞는 것 같아.  
정족수 또는 정해진 기준을 만족하는 수의 노드가 블록을 자신의 체인에 추가하면 합의가 이뤄졌다고 판단.  ex) 누군가가 이 데이터를 다음 블록이라고 하자 -> 나는 그 액션에 동의해(이 과정이 합의)  
그러나 합의가 어려운 이유: **[비잔틴 장군 문제](http://wiki.hash.kr/index.php/%EB%B9%84%EC%9E%94%ED%8B%B4_%EC%9E%A5%EC%95%A0_%ED%97%88%EC%9A%A9)**  


정리: 블록체인의 성질
- 블록체인은 한명 이상의 참여자가 있는 네트워크에서 관리
- 네트워크 참여자 전원은 모든 블록을 동일한 순서로 저장하여 모두 같은 블록체인 유지
- 자격이 있는 참여자는 블록을 제안할 수 있음; 블록 제안 자격은 네트워크마다 상이
- 블록이 체인에 추가됨 = 참여자들이 새 블록을 자신의 체인에 추가
- 따라서 새로운 블록이 체인에 추가되려면 네트워크의 합의가 필요; 합의방법은 네트워크마다 상이  
(어느 한 주체가 단독으로 결정하는 구조가 아닌, 여러 참여자가 합의를 통해 결정하기 때문에 블록체인은 탈중앙화되어 있다고 표현)  
- 참여자 전원은 이전 블록들을 저장하고 있으므로 새로운 블록의 무결성을 확인 가능  
- 새롭게 제안되는 블록은 참여자들이 검증 및 합의할 수 있는 형태여야 함(투명성)  -> 그럼 모두가 이전 기록을 알 고 있어야 하니까 투명하다!  
- 한번 쓰여진 블록은 이전의 합의를 번복할 수 있지 않는 한 변경될 수 ~~없음~~(불변성) -> 거의 불가능하다. 정말 많은 사람이 알고 있으니 변경이 힘들다!  



